{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Indie-go News</title>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
</head>
<body>

    <!-- Banner -->
    <div id="banner">
        <a href="{% url 'home' %}">
            <img src="{% static 'banner.png' %}" alt="Indie-Go News">
        </a>
    </div>

    <!-- Navigation Links -->
    <nav id="nav">
        {% if user.is_authenticated %}
            <!-- Welcome Message for logged in users -->
            <span style="margin-right: 15px; font-weight: bold; font-family: 'Courier New';">
                Hello, {{ user.username }}
            </span>
            
            <a href="{% url 'profile' %}" class="btn">My Profile</a>
            
            <form action="{% url 'logout' %}" method="post" style="display: inline;">
                {% csrf_token %}
                <button type="submit">Sign Out</button>
            </form>        
        {% else %}
            <a href="{% url 'register' %}" class="btn">Register</a>
            <a href="{% url 'login' %}" class="btn">Sign In</a>
        {% endif %}
    </nav>

    <!-- Article Tiles -->
    <main id="articles">

        <div class="filter">
            <form method="get" action="{% url 'home' %}">
                <label for="journalist">Filter by Journalist:</label>
                <select name="journalist" id="journalist">
                    <option value="">All Journalists</option>
                    {% for journalist in journalists %}
                        <option value="{{ journalist.id }}" {% if journalist.id == selected_journalist_id %}selected{% endif %}>
                            {{ journalist.username }}
                        </option>
                    {% endfor %}
                </select>
                <button type="submit">Filter</button>
            </form>
        </div>
            
        <!-- Article Tiles -->
        {% for article in articles %}
            <div class="article-tile">
                <a href="{% url 'article_detail' article.pk article.slug %}">
                    <h2>{{ article.title }}</h2>
                    <p>{{ article.content|truncatechars:150 }}</p>
                </a>
                <p class="author">
                    By {{ article.posted_by.username }}
                    <br>
                    <span style="font-size: 0.8rem; color: #666;">
                        {{ article.created_at|date:"M d, Y" }}
                    </span>
                    
                    {% if user.is_authenticated and user.role == "Reader" %}
                        |
                        <form action="{% url 'subscribe' article.posted_by.id %}" method="post" style="display: inline;">
                            {% csrf_token %}
                            <button type="submit" class="sub-btn">Subscribe</button>
                        </form>
                    {% endif %}
                </p>
            </div>
        {% empty %}
            <div style="text-align: center; padding: 20px;">
                <p>No articles found for this selection.</p>
            </div>
        {% endfor %}
    
    </main>

</body>
</html>